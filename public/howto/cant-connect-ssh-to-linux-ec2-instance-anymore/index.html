<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme="dark"><head>
    <title> Marko Živanović | Can’t connect/SSH to Linux EC2 instance anymore </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.68.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Marko Zivanovic is a programmer, technologist, and one hell of a guy. He loves to learn new programming languages and enjoys long walks on the beach.">
    
    
    
    
    <link rel="stylesheet"
        href="/css/main.min.ce81834785739fa650269589d971e8b17d6f76b62257f16d4e36bf82cf0fcbd8.css"
        type="text/css">
    
    
    <link rel="stylesheet"
        href="/css/markupHighlight.min.cc84ed683057cc175ddfa738ea6ba2d5c882b95cb64f50bf9be918cb3791887b.css"
        type="text/css">
    
        
        
        <link rel="stylesheet"
        href="/css/custom.min.9e93df4890cb8c297ae970fa89f306cf24b008a62b4d766f7e7c65ad0fad6759.css"
        media="screen" />
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <link rel="canonical" href="/howto/cant-connect-ssh-to-linux-ec2-instance-anymore/">

    
    
    <script async defer data-domain="markozivanovic.com" src="https://analytics.chaospigeon.com/js/plausible.js"></script>
    
    
    <script type="text/javascript"
            src="/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            ></script>
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://markozivanovic.com/images/marko_zivanovic.png"/>

<meta name="twitter:title" content="Can’t connect/SSH to Linux EC2 instance anymore"/>
<meta name="twitter:description" content="Chances are that you’re here because you did something stupid. You locked yourself out of your EC2 instance somehow."/>


    
    <meta property="og:title" content="Can’t connect/SSH to Linux EC2 instance anymore" />
<meta property="og:description" content="Chances are that you’re here because you did something stupid. You locked yourself out of your EC2 instance somehow." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://markozivanovic.com/howto/cant-connect-ssh-to-linux-ec2-instance-anymore/" />
<meta property="og:image" content="https://markozivanovic.com/images/marko_zivanovic.png"/>
<meta property="article:published_time" content="2021-01-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-17T00:00:00+00:00" /><meta property="og:site_name" content="Marko Živanović" />

    
</head>
<body><div class="sidebar . ">
    <div class="logo-title">
        <div class="title">
            <img src="/images/profile.jpg" alt="profile picture">
            <h3 title=""><a href="/">Marko Živanović</a></h3>
            <div class="description">
                <p>Musings on the software world and beyond</p>
            </div>
            <div class="projects">
                <li><a href="https://tooloodr.com" target="_blank">tooloodr.com</a>★</li>
                <li><a href="https://theprogrammersoath.com" target="_blank">theprogrammersoath.com</a>★</li>
                <li><a style="color: #fff !important; background-color:#ca2017" href="https://codeofwar.xyz" target="_blank">&nbsp;codeofwar.xyz&nbsp;</a></li>
                
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/m4rkoziv4novic/" rel="me" aria-label="Linkedin">
                    <i class="icon-linkedin-squared icon-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://twitter.com/markozivan0vic" rel="me" aria-label="Twitter">
                    <i class="icon-twitter icon-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/markozivanovic" rel="me" aria-label="GitHub">
                    <i class="icon-github-circled icon-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:marko@markozivanovic.com" rel="me" aria-label="e-mail">
                    <i class="icon-mail-alt icon-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy;  Marko Živanović 2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  . ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/howto/"
                        
                   title="">Howto</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About</a></li>
        
            
            <li><a 
                   href="/tcow/"
                        
                   title="">The Code of War</a></li>
        
        <li><a style="color: #fff; background-color:#ca2017" href="https://codeofwar.xyz"><b>&nbsp;Buy TCOW&nbsp;</b></a></li>
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  . ">
        <div class="post-content">
            
            <div class="post-title">
                <h3>Can’t connect/SSH to Linux EC2 instance anymore</h3>
                
            </div>

            <p>Chances are that you’re here because you did something stupid. You locked yourself out of your EC2 instance somehow. Maybe you’ve played with the firewall settings on the machine, maybe you don’t know what you’ve done. Been there, done that. Luckily, there’s a workaround.</p>
<p>In my case, I’ve messed up <a href="https://en.wikipedia.org/wiki/Uncomplicated_Firewall" target="_blank">UFW</a> config on my Ubuntu instance. If you messed up some other configuration, you might have to edit a different file, but the basics of workaround are the same – attaching a disk from the instance you locked yourself out to the recovery instance you’ll create.</p>
<p>Here are the steps:</p>
<ol>
<li>Create a new recovery instance (the same as the one you messed up)</li>
<li>Stop the problematic instance (DO NOT TERMINATE!)</li>
<li>Detach the volume (problematic volume) from the original instance</li>
<li>Attach it to the recovery instance as <strong>/dev/sdf</strong></li>
<li>SSH to the created recovery instance</li>
<li>Run <strong>$ sudo lsblk</strong> to display the attached volumes and confirm the name of the problem volume. It usually begins with <strong>/dev/xvdf</strong></li>
<li>Mount problem volume: <strong>$ sudo mount /dev/xvdf1 /mnt</strong></li>
<li>Open the UFW configuration file: <strong>$ sudo vim /mnt/etc/ufwufw.conf</strong></li>
<li>Change <strong>ENABLED=yes</strong> to <strong>ENABLED=no</strong> and save</li>
<li>Unmount volume: <strong>$ sudo umount /mnt</strong></li>
<li>Detach the problematic volume from the recovery instance and re-attach it to the original instance as <strong>/dev/sda1</strong>.</li>
<li>Start the original instance and you should be able to log back in.</li>
</ol>
</div>
        <div class="post-footer">
            <div class="info">
                <span class="separator"><a class="category" href="/categories/howto/">howto</a><a class="category" href="/categories/aws/">aws</a></span>
                <span class="separator"><a class="tag" href="/tags/aws/">aws</a><a class="tag" href="/tags/cloud/">cloud</a><a class="tag" href="/tags/ubuntu/">ubuntu</a></span>
            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        ></script></body>

</html>
